# Justfile for Industryts Documentation
#
# Usage:
#   just dev      - Start development server (auto-install if needed)
#   just build    - Build for production
#   just preview  - Preview production build
#   just install  - Install dependencies
#   just clean    - Clean build artifacts

# Default recipe (shown when running 'just' without arguments)
default:
    @just --list

# Start development server with auto-install
dev:
    #!/usr/bin/env bash
    set -euo pipefail

    echo "ğŸš€ Starting Industryts documentation..."

    # Check if node_modules exists
    if [ ! -d "node_modules" ]; then
        echo "ğŸ“¦ Dependencies not found. Installing..."
        just install
    else
        echo "âœ… Dependencies already installed"
    fi

    echo "ğŸ”¥ Starting VitePress dev server..."
    npm run docs:dev

# Install dependencies
install:
    @echo "ğŸ“¦ Installing documentation dependencies..."
    npm install
    @echo "âœ… Installation complete!"

# Build documentation for production
build:
    #!/usr/bin/env bash
    set -euo pipefail

    if [ ! -d "node_modules" ]; then
        echo "ğŸ“¦ Dependencies not found. Installing first..."
        just install
    fi

    echo "ğŸ—ï¸  Building documentation..."
    npm run docs:build
    @echo "âœ… Build complete! Output: .vitepress/dist/"

# Preview production build
preview:
    #!/usr/bin/env bash
    set -euo pipefail

    if [ ! -d ".vitepress/dist" ]; then
        echo "âš ï¸  Build not found. Building first..."
        just build
    fi

    echo "ğŸ‘€ Previewing documentation..."
    npm run docs:preview

# Clean build artifacts
clean:
    @echo "ğŸ§¹ Cleaning build artifacts..."
    rm -rf .vitepress/dist
    rm -rf .vitepress/cache
    @echo "âœ… Clean complete!"

# Clean everything including node_modules
clean-all:
    @echo "ğŸ§¹ Cleaning everything..."
    rm -rf .vitepress/dist
    rm -rf .vitepress/cache
    rm -rf node_modules
    rm -f package-lock.json
    @echo "âœ… Deep clean complete!"

# Reinstall dependencies (clean + install)
reinstall:
    just clean-all
    just install

# Check for updates
check:
    @echo "ğŸ” Checking for outdated packages..."
    npm outdated || true

# Update dependencies
update:
    @echo "â¬†ï¸  Updating dependencies..."
    npm update
    @echo "âœ… Update complete!"
