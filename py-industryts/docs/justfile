# Justfile for py-industryts documentation
#
# Usage:
#   just dev      - Start development server (auto-install if needed)
#   just build    - Build documentation (auto-install if needed)
#   just preview  - Preview built documentation
#   just install  - Install dependencies
#   just clean    - Clean build artifacts

# Default recipe to display help
default:
    @just --list

# Install dependencies
install:
    @echo "ğŸ“¦ Installing dependencies..."
    npm install
    @echo "âœ… Dependencies installed!"

# Start development server with auto-install
dev:
    #!/usr/bin/env bash
    set -euo pipefail

    echo "ğŸš€ Starting development server..."

    # Check if node_modules exists
    if [ ! -d "node_modules" ]; then
        echo "ğŸ“¦ Dependencies not found. Installing..."
        just install
    else
        echo "âœ… Dependencies already installed"
    fi

    echo "ğŸ”¥ Starting VitePress dev server..."
    npm run docs:dev

# Build documentation with auto-install
build:
    #!/usr/bin/env bash
    set -euo pipefail

    echo "ğŸ”¨ Building documentation..."

    # Check if node_modules exists
    if [ ! -d "node_modules" ]; then
        echo "ğŸ“¦ Dependencies not found. Installing first..."
        just install
    fi

    npm run docs:build
    echo "âœ… Build complete! Output in .vitepress/dist/"

# Preview built documentation with auto-build
preview:
    #!/usr/bin/env bash
    set -euo pipefail

    echo "ğŸ‘€ Previewing built documentation..."

    # Check if build exists
    if [ ! -d ".vitepress/dist" ]; then
        echo "âš ï¸  Build not found. Building first..."
        just build
    fi

    npm run docs:preview

# Clean build artifacts
clean:
    @echo "ğŸ§¹ Cleaning build artifacts..."
    rm -rf .vitepress/dist
    rm -rf .vitepress/cache
    @echo "âœ… Cleaned!"

# Clean everything including node_modules
clean-all:
    @echo "ğŸ§¹ Cleaning everything..."
    rm -rf .vitepress/dist
    rm -rf .vitepress/cache
    rm -rf node_modules
    rm -f package-lock.json
    @echo "âœ… Deep clean complete!"

# Reinstall dependencies (clean + install)
reinstall:
    just clean-all
    just install

# Full setup (install + build)
setup: install build
    @echo "âœ… Setup complete!"

# Development workflow (install + dev)
dev-setup: install dev
    @echo "âœ… Development setup complete!"

# Check for outdated packages
check:
    @echo "ğŸ” Checking for outdated packages..."
    npm outdated || true

# Update dependencies
update:
    @echo "â¬†ï¸  Updating dependencies..."
    npm update
    @echo "âœ… Update complete!"
